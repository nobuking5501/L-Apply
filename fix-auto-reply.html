<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•è¿”ä¿¡ä¿®æ­£ãƒ„ãƒ¼ãƒ«</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, query, getDocs, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebaseè¨­å®šï¼ˆå®Ÿéš›ã®è¨­å®šã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyAqlSDzU6OqxC7aKFNh8YrpQdBfQ-MJwKw",
            authDomain: "l-apply.firebaseapp.com",
            projectId: "l-apply",
            storageBucket: "l-apply.firebasestorage.app",
            messagingSenderId: "1076344687205",
            appId: "1:1076344687205:web:c7bd86f8f0c99a9827a8e9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadAutoReplies() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>ğŸ” è‡ªå‹•è¿”ä¿¡ã‚’æ¤œç´¢ä¸­...</p>';

            try {
                const q = query(collection(db, 'auto_reply_messages'));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    output.innerHTML = '<p>âœ… è‡ªå‹•è¿”ä¿¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                    return;
                }

                output.innerHTML = `<p>è¦‹ã¤ã‹ã£ãŸè‡ªå‹•è¿”ä¿¡: ${snapshot.size}ä»¶</p>`;

                const list = document.createElement('div');
                list.style.cssText = 'margin-top: 20px;';

                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const card = document.createElement('div');
                    card.style.cssText = 'border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; border-radius: 8px; background: #f9f9f9;';

                    const isProblematic = data.message && data.message.includes('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™');

                    if (isProblematic) {
                        card.style.border = '2px solid #f44336';
                        card.style.background = '#ffebee';
                    }

                    card.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>ID:</strong> ${docSnap.id}<br>
                            <strong>çµ„ç¹”ID:</strong> ${data.organizationId || '(ãªã—)'}<br>
                            <strong>ãƒˆãƒªã‚¬ãƒ¼:</strong> "${data.trigger}"<br>
                            <strong>æœ‰åŠ¹:</strong> ${data.isActive ? 'âœ… ã¯ã„' : 'âŒ ã„ã„ãˆ'}<br>
                            ${isProblematic ? '<strong style="color: #f44336;">âš ï¸ ã“ã‚ŒãŒå•é¡Œã®è‡ªå‹•è¿”ä¿¡ã§ã™</strong><br>' : ''}
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 4px; margin-bottom: 10px; white-space: pre-wrap; font-family: monospace; font-size: 12px;">
${data.message}</div>
                        <button
                            onclick="deleteReply('${docSnap.id}')"
                            style="background: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                            å‰Šé™¤
                        </button>
                    `;

                    list.appendChild(card);
                });

                output.appendChild(list);
            } catch (error) {
                output.innerHTML = `<p style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                console.error('Error:', error);
            }
        }

        window.deleteReply = async function(id) {
            if (!confirm('ã“ã®è‡ªå‹•è¿”ä¿¡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                await deleteDoc(doc(db, 'auto_reply_messages', id));
                alert('âœ… å‰Šé™¤ã—ã¾ã—ãŸ');
                loadAutoReplies(); // ãƒªãƒ­ãƒ¼ãƒ‰
            } catch (error) {
                alert('âŒ å‰Šé™¤å¤±æ•—: ' + error.message);
                console.error('Delete error:', error);
            }
        };

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        window.addEventListener('load', loadAutoReplies);
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        #output {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è‡ªå‹•è¿”ä¿¡ä¿®æ­£ãƒ„ãƒ¼ãƒ«</h1>
    <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã§å•é¡Œã®ã‚ã‚‹è‡ªå‹•è¿”ä¿¡ã‚’ç¢ºèªãƒ»å‰Šé™¤ã§ãã¾ã™</p>
    <div id="output">
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
</body>
</html>
