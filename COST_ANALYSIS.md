# L-Apply コスト分析

## 💰 月額980円は本当に赤字になるのか？

結論から言うと：**ステップ配信を制限すれば、980円でも黒字です！**

---

## 📊 実際のコスト計算

### 顧客1社あたりの月間コスト

#### シナリオA: ステップ配信なし（推奨）

**Vercel（フロントエンド）**
```
無料枠:
- 帯域幅: 100GB/月
- ビルド時間: 100時間/月
- サーバーレス実行: 100GB-時間/月

実際の使用量（1社あたり）:
- ページビュー: 月500回程度
- 帯域幅: 50MB程度
- ビルド: 月1回（5分）

→ 100社でも無料枠内
→ コスト: ¥0
```

**Firebase Functions（バックエンド）**
```
無料枠:
- 呼び出し: 200万回/月
- GB秒: 40万GB秒/月
- CPU秒: 20万CPU秒/月
- ネットワーク送信: 5GB/月

実際の使用量（1社で月50件の申込）:
┌─────────────────────────────┐
│ 申込処理（apply）             │
│ - 呼び出し: 50回              │
│ - 実行時間: 平均500ms         │
│ - メモリ: 256MB               │
│ - CPU使用: 50回 × 0.5秒 = 25秒│
│ - GB秒: 50 × 0.5 × 0.25 = 6.25│
└─────────────────────────────┘

┌─────────────────────────────┐
│ リマインド配信（remind）      │
│ - 呼び出し: 50回（1回/申込）  │
│ - 実行時間: 平均300ms         │
│ - メモリ: 256MB               │
│ - CPU使用: 50回 × 0.3秒 = 15秒│
│ - GB秒: 50 × 0.3 × 0.25 = 3.75│
└─────────────────────────────┘

┌─────────────────────────────┐
│ Webhook（メッセージ受信）     │
│ - 呼び出し: 月200回程度       │
│ - 実行時間: 平均200ms         │
│ - メモリ: 256MB               │
│ - CPU使用: 200回 × 0.2秒 = 40秒│
│ - GB秒: 200 × 0.2 × 0.25 = 10│
└─────────────────────────────┘

合計（1社/月）:
- 呼び出し: 300回
- CPU秒: 80秒
- GB秒: 20GB秒

100社でも:
- 呼び出し: 30,000回 → 無料枠内（200万回）
- CPU秒: 8,000秒 → 無料枠内（20万秒）
- GB秒: 2,000GB秒 → 無料枠内（40万GB秒）

→ コスト: ¥0
```

**Firestore（データベース）**
```
無料枠:
- 読み取り: 50,000回/日
- 書き込み: 20,000回/日
- 削除: 20,000回/日
- ストレージ: 1GB

実際の使用量（1社で月50件の申込）:
┌─────────────────────────────┐
│ 申込処理                     │
│ - 書き込み: 50回（申込）      │
│ - 書き込み: 50回（リマインダー）│
│ - 読み取り: 100回（チェック）  │
└─────────────────────────────┘

┌─────────────────────────────┐
│ リマインド配信               │
│ - 読み取り: 50回              │
│ - 書き込み: 50回（送信済み）  │
└─────────────────────────────┘

┌─────────────────────────────┐
│ Webhook                      │
│ - 読み取り: 200回             │
│ - 書き込み: 50回              │
└─────────────────────────────┘

合計（1社/月）:
- 読み取り: 350回/月 = 11.6回/日
- 書き込み: 200回/月 = 6.6回/日

100社でも:
- 読み取り: 1,160回/日 → 無料枠内（50,000回）
- 書き込み: 660回/日 → 無料枠内（20,000回）

→ コスト: ¥0
```

**LINE Messaging API**
```
無料枠:
- メッセージ送信: 200通/月

実際の使用量（1社で月50件の申込）:
- 申込完了: 50通
- リマインド: 50通
- 予約確認など: 50通
─────────────
合計: 150通/月 → 無料枠内

→ コスト: ¥0
```

**合計コスト（ステップ配信なし）**
```
¥0 + ¥0 + ¥0 + ¥0 = ¥0/社/月
```

---

#### シナリオB: ステップ配信あり（10ステップ）

**追加されるコスト**

**Firebase Functions（deliverSteps）**
```
実際の使用量（1社で月50件の申込 × 10ステップ）:

┌─────────────────────────────┐
│ ステップ配信実行             │
│ - 呼び出し: 毎時1回チェック   │
│ - 月間: 24時間 × 30日 = 720回│
│ - 実行時間: 平均1秒          │
│ - メモリ: 256MB              │
│ - CPU使用: 720回 × 1秒 = 720秒│
│ - GB秒: 720 × 1 × 0.25 = 180│
└─────────────────────────────┘

┌─────────────────────────────┐
│ メッセージ送信               │
│ - 申込50件 × 10ステップ = 500通│
└─────────────────────────────┘

合計（1社/月）:
- 呼び出し: 720回
- CPU秒: 720秒
- GB秒: 180GB秒
- メッセージ: 500通

100社だと:
- 呼び出し: 72,000回 → 無料枠内
- CPU秒: 72,000秒 → 無料枠内
- GB秒: 18,000GB秒 → 無料枠内
- メッセージ: 50,000通 → 有料（¥5/通 超過分）
```

**LINE Messaging API（超過分）**
```
1社あたり:
- 送信: 500通/月
- 無料枠: 200通/月
- 超過: 300通

100社だと:
- 超過: 30,000通
- コスト: 30,000通 × ¥5 = ¥150,000/月

1社あたり: ¥1,500/月
```

**合計コスト（ステップ配信10個）**
```
¥1,500/社/月 → 赤字！
```

---

## 📈 実際のコスト構造

### 無料枠を超えるポイント

#### 1. LINE Messaging API
```
無料枠: 200通/月

超えるケース:
┌────────────────────────────┐
│ ステップ配信なし             │
│ - 申込完了: 50通            │
│ - リマインド: 50通          │
│ - 自動応答: 50通            │
│ - 合計: 150通 → セーフ      │
└────────────────────────────┘

┌────────────────────────────┐
│ ステップ配信3個              │
│ - 申込完了: 50通            │
│ - リマインド: 50通          │
│ - 自動応答: 50通            │
│ - ステップ: 50×3 = 150通    │
│ - 合計: 300通 → アウト      │
│ - 超過: 100通               │
│ - コスト: ¥500/月           │
└────────────────────────────┘

┌────────────────────────────┐
│ ステップ配信10個             │
│ - 申込完了: 50通            │
│ - リマインド: 50通          │
│ - 自動応答: 50通            │
│ - ステップ: 50×10 = 500通   │
│ - 合計: 650通 → 大幅超過    │
│ - 超過: 450通               │
│ - コスト: ¥2,250/月         │
└────────────────────────────┘
```

#### 2. Firebase Functions
```
無料枠:
- 呼び出し: 200万回/月
- CPU秒: 20万秒/月

現実的に超えることはない:
- 1,000社でも: 30万回/呼び出し
- 1,000社でも: 8万秒/CPU
→ まだ無料枠内
```

#### 3. Firestore
```
無料枠:
- 読み取り: 150万回/月
- 書き込み: 60万回/月

現実的に超えることはない:
- 1,000社でも: 35万回/読み取り
- 1,000社でも: 20万回/書き込み
→ まだ無料枠内
```

---

## 💡 結論：どこで赤字になるか

### 赤字になるポイント

**LINE Messaging APIの超過料金だけ**

```
売上: ¥980/月
コスト:
┌────────────────────────────┐
│ Vercel: ¥0                 │
│ Firebase Functions: ¥0     │
│ Firestore: ¥0              │
│ LINE API: ?                │
└────────────────────────────┘

ステップ配信なし:
- LINE API: ¥0（無料枠内）
→ 利益: ¥980 ✅

ステップ配信3個:
- LINE API: ¥500（超過100通）
→ 利益: ¥480 ✅

ステップ配信5個:
- LINE API: ¥1,000（超過200通）
→ 利益: -¥20 ❌ 赤字

ステップ配信10個:
- LINE API: ¥2,250（超過450通）
→ 利益: -¥1,270 ❌ 大赤字
```

---

## 🎯 安全な運用ライン

### プラン別の利益率

| プラン | 価格 | ステップ | LINEコスト | 利益 | 利益率 |
|--------|------|---------|-----------|------|--------|
| モニター | ¥980 | なし | ¥0 | ¥980 | 100% |
| モニター | ¥980 | 3個 | ¥500 | ¥480 | 49% |
| モニター | ¥980 | 5個 | ¥1,000 | -¥20 | -2% ❌ |
| スタンダード | ¥3,980 | 3個 | ¥500 | ¥3,480 | 87% |
| プロ | ¥6,980 | 10個 | ¥2,250 | ¥4,730 | 68% |

---

## 📊 100社規模でのコスト

### パターンA: ステップ配信なし（推奨）

```
売上: 100社 × ¥980 = ¥98,000
コスト:
- Vercel: ¥0
- Firebase: ¥0
- LINE API: ¥0
─────────────────────
利益: ¥98,000/月
年間: ¥1,176,000
```

### パターンB: ステップ配信3個まで許可

```
売上: 100社 × ¥980 = ¥98,000
コスト:
- Vercel: ¥0
- Firebase: ¥0
- LINE API: 100社 × ¥500 = ¥50,000
─────────────────────
利益: ¥48,000/月
年間: ¥576,000
```

### パターンC: ステップ配信10個許可（危険）

```
売上: 100社 × ¥980 = ¥98,000
コスト:
- Vercel: ¥0
- Firebase: ¥0
- LINE API: 100社 × ¥2,250 = ¥225,000
─────────────────────
利益: -¥127,000/月 ❌
年間: -¥1,524,000 ❌
```

---

## 🎯 最終結論

### 赤字になるポイント

**唯一のリスク: LINE Messaging APIの超過料金**

```
安全ライン: 月200通まで無料
危険ライン: 月500通以上

内訳:
- 申込完了: 50通
- リマインド: 50通
- 自動応答: 50通
- ステップ: ??? ← ここを制限
─────────────────
合計: 200通以内に抑える
```

### 安全な運用方法

**モニタープラン（¥980）**
```
✅ ステップ配信なし
→ 月150通程度
→ コスト: ¥0
→ 利益: ¥980 100%黒字
```

**スタンダードプラン（¥3,980）**
```
✅ ステップ配信3個まで
→ 月300通程度
→ コスト: ¥500
→ 利益: ¥3,480 87%黒字
```

**プロプラン（¥6,980）**
```
✅ ステップ配信10個まで
→ 月650通程度
→ コスト: ¥2,250
→ 利益: ¥4,730 68%黒字
```

---

## 💰 補足：スケール時のコスト

### 1,000社規模になると？

**Vercel**
```
無料枠を超える可能性:
- 帯域幅: 100GB超え
→ Pro プラン: $20/月（¥3,000）

1社あたり: ¥3
```

**Firebase Functions**
```
まだ無料枠内:
- 呼び出し: 30万回（無料枠200万回）
- CPU秒: 8万秒（無料枠20万秒）

→ コスト: ¥0
```

**合計**
```
1,000社でも:
- Vercel: ¥3/社
- Firebase: ¥0/社
- LINE: ステップ配信次第

→ ほぼ無料で運用可能
```

---

## 📝 実践的なアドバイス

### モニター期間（¥980）の推奨設定

**含める機能** ✅
- 申込受付（月50件）
- 自動リマインド（1回/申込）
- LINE自動応答（基本コマンド）
→ 月間150通程度 = 無料枠内

**含めない機能** ❌
- ステップ配信
→ これだけで500通増える = ¥2,250のコスト

### 結論

**980円でも黒字で運用できます！**

ただし：
- ✅ ステップ配信なし → 100%黒字
- ⚠️ ステップ配信3個 → 50%黒字
- ❌ ステップ配信5個以上 → 赤字

だから、モニタープランでは
**ステップ配信を制限すべき**です！
