# リッチメニュー設定ガイド

## 画像の仕様

リッチメニューの画像は以下の仕様を満たす必要があります：

### サイズ

- **大テンプレート（6分割）**: 2500 x 1686px
- **小テンプレート（3分割または6分割）**: 2500 x 843px

### 形式

- **ファイル形式**: PNG または JPEG
- **最大ファイルサイズ**: 1MB以下
- **色空間**: RGB

## 設定方法

### 方法1: LINE Developers Console（手動・推奨）

最も簡単な方法です。

#### 手順:

1. **LINE Developers Consoleにアクセス**
   - https://developers.line.biz/console/ を開く
   - ログインして、プロバイダー「L-Apply」を選択
   - Messaging APIチャンネルを選択

2. **リッチメニューページへ移動**
   - 左メニューから「Messaging API」タブをクリック
   - ページを下にスクロールして「リッチメニュー」セクションを見つける
   - 「作成」ボタンをクリック

3. **基本情報を入力**
   ```
   タイトル: L-Applyメインメニュー
   表示期間: 常に表示
   メニューバーのテキスト: メニュー
   ```

4. **テンプレートを選択**
   - 画像のサイズに合わせてテンプレートを選択
   - 推奨: 大テンプレート（6分割）

5. **画像をアップロード**
   - 「画像をアップロード」をクリック
   - 用意した画像ファイルを選択

6. **アクション領域を設定**

   画像の各領域をクリックして、以下の設定を行います：

   **6分割レイアウトの推奨設定:**

   | 位置 | タイプ | 設定内容 |
   |------|--------|----------|
   | **左上** | リンク | <br>ラベル: `セミナー申込`<br>URL: `https://liff.line.me/2008405494-nKEy7Pl0` |
   | **中上** | テキスト | <br>ラベル: `予約確認`<br>テキスト: `予約確認` |
   | **右上** | テキスト | <br>ラベル: `キャンセル`<br>テキスト: `キャンセル` |
   | **左下** | リンク | <br>ラベル: `お知らせ`<br>URL: `https://l-apply.web.app` |
   | **中下** | テキスト | <br>ラベル: `配信停止`<br>テキスト: `配信停止` |
   | **右下** | テキスト | <br>ラベル: `再開`<br>テキスト: `再開` |

7. **保存して公開**
   - 「保存」ボタンをクリック
   - 「公開」ボタンをクリック
   - 確認ダイアログで「OK」をクリック

8. **動作確認**
   - LINEアプリでBotを開く
   - 画面下部にリッチメニューが表示されることを確認
   - 各ボタンをタップして動作を確認

---

### 方法2: プログラム（自動）

スクリプトを使って自動的に設定します。

#### 前提条件:

- Node.js がインストールされていること
- プロジェクトのセットアップが完了していること

#### 手順:

1. **必要なパッケージをインストール**
   ```bash
   npm install axios dotenv
   ```

2. **リッチメニュー画像を配置**
   ```bash
   # プロジェクトルートに画像を配置
   # ファイル名: richmenu-image.png
   ```

   別の場所に配置する場合は、`scripts/setup-richmenu.js`の`IMAGE_PATH`を変更してください。

3. **スクリプトを実行**
   ```bash
   node scripts/setup-richmenu.js
   ```

4. **結果の確認**
   - スクリプトが成功すると、リッチメニューIDが表示されます
   - LINEアプリでBotを開いて確認してください

#### トラブルシューティング:

**エラー: 画像ファイルが見つかりません**
```bash
# 画像のパスを確認
ls -la richmenu-image.png

# または、スクリプト内のIMAGE_PATHを変更
```

**エラー: 環境変数が設定されていません**
```bash
# functions/.envファイルを確認
cat functions/.env

# 必要な環境変数:
# - LINE_CHANNEL_ACCESS_TOKEN
# - LIFF_ID
# - APP_BASE_URL
```

---

## リッチメニューのレイアウト例

### 6分割レイアウト (2500 x 1686px)

```
+------------------+------------------+------------------+
|                  |                  |                  |
|  セミナー申込    |    予約確認      |   キャンセル     |
|  (LIFF)          |   (テキスト)     |  (テキスト)      |
|                  |                  |                  |
+------------------+------------------+------------------+
|                  |                  |                  |
|   お知らせ       |    配信停止      |     再開         |
|   (URL)          |   (テキスト)     |  (テキスト)      |
|                  |                  |                  |
+------------------+------------------+------------------+
```

各領域のサイズ:
- 幅: 833px または 834px
- 高さ: 843px

### 3分割レイアウト (2500 x 843px)

```
+------------------+------------------+------------------+
|                  |                  |                  |
|  セミナー申込    |    予約確認      |   キャンセル     |
|  (LIFF)          |   (テキスト)     |  (テキスト)      |
|                  |                  |                  |
+------------------+------------------+------------------+
```

各領域のサイズ:
- 幅: 833px または 834px
- 高さ: 843px

---

## デザインのヒント

### テキスト配置
- 各領域の中央にテキストを配置
- フォントサイズ: 24pt以上推奨
- 読みやすい太めのフォント使用

### 色使い
- ボタンごとに色を変えると分かりやすい
- 重要なアクション（申込）は目立つ色に
- アイコンを使うとより直感的

### アイコン
- 各ボタンにアイコンを追加すると分かりやすい
- 推奨アイコン:
  - セミナー申込: 📝 または カレンダーアイコン
  - 予約確認: 🔍 または チェックアイコン
  - キャンセル: ❌ または 停止アイコン
  - お知らせ: 📢 または 情報アイコン
  - 配信停止: 🔕 または ミュートアイコン
  - 再開: ▶️ または スタートアイコン

---

## リッチメニューの更新

### 既存のリッチメニューを削除して新規作成:

**LINE Developers Consoleの場合:**
1. 既存のリッチメニューを選択
2. 「削除」ボタンをクリック
3. 新しいリッチメニューを作成

**スクリプトの場合:**
- スクリプトを再実行すると、既存のリッチメニューが自動的に削除されます
- その後、新しいリッチメニューが作成されます

---

## 動作確認

リッチメニューを設定したら、以下を確認してください：

1. **表示確認**
   - [ ] LINEアプリでBotのトーク画面を開く
   - [ ] 画面下部にリッチメニューが表示される
   - [ ] 画像が正しく表示される

2. **機能確認**
   - [ ] 「セミナー申込」→ LIFFアプリが開く
   - [ ] 「予約確認」→ 予約情報が返信される
   - [ ] 「キャンセル」→ キャンセル確認メッセージが返信される
   - [ ] 「お知らせ」→ Webサイトが開く
   - [ ] 「配信停止」→ 配信停止メッセージが返信される
   - [ ] 「再開」→ 配信再開メッセージが返信される

3. **トラブル時の確認**
   - Cloud Functionsがデプロイされているか
   - Webhookが正しく設定されているか
   - 環境変数が正しく設定されているか

---

## よくある質問

**Q: リッチメニューが表示されません**
A: 以下を確認してください:
- リッチメニューが「公開」状態になっているか
- 「表示期間」が「常に表示」に設定されているか
- Botをブロックしていないか
- LINEアプリを再起動してみる

**Q: 画像のサイズが合いません**
A: 画像編集ソフトで正確なサイズにリサイズしてください:
- 推奨ツール: Photoshop, GIMP, オンライン画像エディタ
- サイズ: 2500 x 1686px または 2500 x 843px

**Q: ボタンを押しても反応しません**
A: 以下を確認してください:
- Cloud Functionsがデプロイされているか
- Webhook URLが正しく設定されているか
- アクション領域が正しく設定されているか

**Q: 複数のリッチメニューを切り替えたい**
A: Messaging APIを使って条件に応じたリッチメニューの切り替えが可能です。詳しくは[LINE Developers ドキュメント](https://developers.line.biz/ja/docs/messaging-api/using-rich-menus/)を参照してください。

---

## 参考リンク

- [LINE Messaging API - リッチメニュー](https://developers.line.biz/ja/docs/messaging-api/using-rich-menus/)
- [リッチメニューデザインガイドライン](https://developers.line.biz/ja/docs/messaging-api/rich-menu-design-guidelines/)
- [LIFFアプリ](https://developers.line.biz/ja/docs/liff/overview/)
