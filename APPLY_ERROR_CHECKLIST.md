# 申込フォームエラー - 確認チェックリスト

組織ID: `org_XOVcuVO7o6Op6idItDHsqiBgdBD3`

## 🔴 最も可能性が高い原因：リッチメニューのURL設定

### ✅ 正しいURL形式

LINEリッチメニューのURLは以下の形式である必要があります：

```
https://liff.line.me/<LIFF_ID>?liffId=<LIFF_ID>
```

**重要:** URLに `?liffId=<LIFF_ID>` パラメータが必須です！

### ❌ 間違った例

```
https://liff.line.me/<LIFF_ID>
```
↑ パラメータがないと「LIFF IDが指定されていません」エラーが出ます

---

## 📋 確認手順

### 1. LINEリッチメニューのURL確認

1. LINE Official Account Manager にログイン
2. 「リッチメニュー」→該当のリッチメニューを選択
3. 「申込」ボタンのURLを確認

**確認ポイント:**
- URL に `?liffId=` が含まれているか
- LIFF IDが2回出現しているか（ドメインの後と、パラメータ）

例：
```
https://liff.line.me/1234567890-abcdefgh?liffId=1234567890-abcdefgh
                    ↑ここに1回目        ↑ここに2回目
```

---

### 2. ブラウザの開発者ツールで確認

実際に申込を試みた際のエラーを確認：

1. スマホでLINEアプリを開く
2. PCと接続してリモートデバッグ（または、ブラウザでLIFFを開く）
3. 開発者ツール（F12）を開く
4. 「Console」タブを確認
5. 申込ボタンをタップ
6. エラーメッセージを確認

**よくあるエラーメッセージ:**
- `LIFF IDが指定されていません` → リッチメニューURLに `?liffId=` がない
- `Organization not found` → LIFF IDが正しく設定されていない
- `現在公開中のイベントがありません` → アクティブなイベントがない
- `Application already exists` → 重複申込
- `選択された日時は満席です` → 予約枠が満席

---

### 3. Firebaseコンソールでログ確認

より詳細なエラーを確認するには：

1. [Firebase Console](https://console.firebase.google.com/) にログイン
2. プロジェクトを選択
3. 左メニュー「Functions」をクリック
4. `apply` 関数を探して「ログ」をクリック
5. 最近のエラーログを確認

**ログの見方:**
- 赤色のエントリ = エラー
- エラーメッセージを確認して原因を特定

---

### 4. 重複申込の確認

同じユーザーが同じ日時で既に申込済みの可能性：

1. 管理ダッシュボードにログイン
2. 「申込一覧」を開く
3. 該当ユーザーの申込履歴を確認
4. 同じ日時の申込があれば削除またはキャンセル

---

### 5. Firebase Functionsのデプロイ確認

最新のコードがデプロイされているか確認：

```bash
# デプロイ日時を確認
firebase functions:list

# 最新版をデプロイ
cd functions
npm run build
firebase deploy --only functions:apply
```

---

## 🛠️ 解決方法

### 問題A: リッチメニューURLにliffIdパラメータがない

**解決策:**
1. LINE Official Account Manager でリッチメニューを編集
2. 「申込」ボタンのURLを以下に変更：
   ```
   https://liff.line.me/<LIFF_ID>?liffId=<LIFF_ID>
   ```
3. 保存して再度テスト

### 問題B: 重複申込

**解決策:**
1. 管理ダッシュボード→申込一覧
2. 該当の申込を見つけて「キャンセル」
3. 再度申込を試す

### 問題C: イベントが公開されていない

**解決策:**
1. 管理ダッシュボード→イベント管理
2. イベントの「公開」スイッチをONにする

### 問題D: 予約枠が満席

**解決策:**
1. 管理ダッシュボード→イベント管理
2. イベントを編集
3. 予約枠の定員を増やすか、新しい予約枠を追加

### 問題E: サブスクリプション上限

**解決策:**
1. 管理ダッシュボード→サブスクリプション
2. プランをアップグレード

---

## 📞 サポート

上記の手順で解決しない場合：

1. Firebaseコンソールのエラーログのスクリーンショットを共有
2. ブラウザの開発者ツールのエラーメッセージを共有
3. リッチメニューのURL設定のスクリーンショットを共有

これらの情報があれば、より具体的な解決策を提示できます。
