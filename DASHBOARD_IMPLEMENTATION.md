# L-Apply ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…å®Œäº†

## ğŸ“‹ å®Ÿè£…å®Œäº†é …ç›®

### 1. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  âœ…
- Firebase Authenticationçµ±åˆ
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- è‡ªå‹•çµ„ç¹”ä½œæˆæ©Ÿèƒ½
- ãƒ­ã‚°ã‚¤ãƒ³/ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆï¼ˆProtectedRouteï¼‰

### 2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UI âœ…
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
- ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
- ç¾ã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³

### 3. ä¸»è¦ç”»é¢ âœ…

#### ãƒ›ãƒ¼ãƒ ç”»é¢ (`/dashboard`)
- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã€ç”³è¾¼ã€é…ä¿¡çŠ¶æ³ï¼‰
- æœ€è¿‘ã®ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
- æœ€è¿‘ã®ç”³è¾¼ä¸€è¦§
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º

#### ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ç”»é¢ (`/dashboard/events`)
- ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
- ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ç·¨é›†æ©Ÿèƒ½
- ã‚¹ãƒ­ãƒƒãƒˆï¼ˆæ—¥æ™‚ï¼‰ç®¡ç†
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ
- å®šå“¡ç®¡ç†

#### ã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡ç”»é¢ (`/dashboard/step-delivery`)
- é…ä¿¡çµ±è¨ˆï¼ˆç·é…ä¿¡æ•°ã€é…ä¿¡å¾…ã¡ã€é…ä¿¡æ¸ˆã¿ã€ã‚¹ã‚­ãƒƒãƒ—ï¼‰
- ã‚¹ãƒ†ãƒƒãƒ—è¨­å®šè¡¨ç¤º
- é…ä¿¡å±¥æ­´ä¸€è¦§
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ³ç¢ºèª

#### ç”³è¾¼è€…ç®¡ç†ç”»é¢ (`/dashboard/applications`)
- ç”³è¾¼è€…ä¸€è¦§è¡¨ç¤º
- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥è¡¨ç¤º
- CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- è©³ç´°æƒ…å ±è¡¨ç¤º

#### è¨­å®šç”»é¢ (`/dashboard/settings`)
- çµ„ç¹”æƒ…å ±ç·¨é›†
- LINEé€£æºè¨­å®š
- ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šï¼ˆã‚«ãƒ©ãƒ¼ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

### 4. ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ âœ…
- æ©Ÿèƒ½ç´¹ä»‹
- CTAï¼ˆè¡Œå‹•å–šèµ·ï¼‰ãƒœã‚¿ãƒ³
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

## ğŸ¨ ä½¿ç”¨æŠ€è¡“

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 14 (App Router)
- **UI**: Shadcn/ui + Tailwind CSS
- **èªè¨¼**: Firebase Authentication
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloud Firestore
- **çŠ¶æ…‹ç®¡ç†**: React Context API
- **ã‚¢ã‚¤ã‚³ãƒ³**: Lucide React
- **å‹å®‰å…¨æ€§**: TypeScript

## ğŸ“ æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
app/
â”œâ”€â”€ page.tsx                          # ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸
â”œâ”€â”€ login/page.tsx                    # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”œâ”€â”€ signup/page.tsx                   # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
â”œâ”€â”€ reset-password/page.tsx           # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
â””â”€â”€ dashboard/
    â”œâ”€â”€ layout.tsx                    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
    â”œâ”€â”€ page.tsx                      # ãƒ›ãƒ¼ãƒ ç”»é¢
    â”œâ”€â”€ events/page.tsx               # ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
    â”œâ”€â”€ step-delivery/page.tsx        # ã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡
    â”œâ”€â”€ applications/page.tsx         # ç”³è¾¼è€…ç®¡ç†
    â””â”€â”€ settings/page.tsx             # è¨­å®š

components/
â”œâ”€â”€ ProtectedRoute.tsx                # èªè¨¼ã‚¬ãƒ¼ãƒ‰
â””â”€â”€ ui/
    â”œâ”€â”€ button.tsx                    # ãƒœã‚¿ãƒ³
    â”œâ”€â”€ input.tsx                     # å…¥åŠ›
    â”œâ”€â”€ label.tsx                     # ãƒ©ãƒ™ãƒ«
    â”œâ”€â”€ card.tsx                      # ã‚«ãƒ¼ãƒ‰
    â””â”€â”€ dialog.tsx                    # ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

contexts/
â””â”€â”€ AuthContext.tsx                   # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

types/
â””â”€â”€ index.ts                          # å‹å®šç¾©

lib/
â””â”€â”€ utils.ts                          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
```bash
npm run dev
```
ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹

### 2. Firebaseè¨­å®šã®ç¢ºèª
- Firebase Console ã§ Authentication ã‚’æœ‰åŠ¹åŒ–
- ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’æœ‰åŠ¹åŒ–
- Firestore ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ï¼ˆå¾Œè¿°ï¼‰

### 3. Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®æ›´æ–°

ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒã‚§ãƒƒã‚¯
    function isSignedIn() {
      return request.auth != null;
    }

    // è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    // åŒã˜çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹
    function isSameOrganization(orgId) {
      return isSignedIn() &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.organizationId == orgId;
    }

    // Organizations
    match /organizations/{orgId} {
      allow read: if isSameOrganization(orgId);
      allow write: if isSameOrganization(orgId);
    }

    // Users
    match /users/{userId} {
      allow read: if isOwner(userId);
      allow write: if isOwner(userId);
    }

    // Events
    match /events/{eventId} {
      allow read: if isSignedIn() && isSameOrganization(resource.data.organizationId);
      allow write: if isSignedIn() && isSameOrganization(request.resource.data.organizationId);
    }

    // Applications
    match /applications/{applicationId} {
      allow read: if isSignedIn() && isSameOrganization(resource.data.organizationId);
      allow write: if isSignedIn() && isSameOrganization(request.resource.data.organizationId);
    }

    // Step Deliveries
    match /step_deliveries/{deliveryId} {
      allow read: if isSignedIn() && isSameOrganization(resource.data.organizationId);
      allow write: if isSignedIn() && isSameOrganization(request.resource.data.organizationId);
    }
  }
}
```

### 4. æ—¢å­˜ã®Cloud Functionsã‚’ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã«æ›´æ–°

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¦ `organizationId` ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

#### `functions/src/apply-prod.ts`
```typescript
// ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ã« organizationId ã‚’è¿½åŠ 
const applicationData = {
  organizationId: eventData.organizationId, // è¿½åŠ 
  eventId,
  userId,
  name,
  phone,
  email,
  slotId,
  slotAt,
  consent,
  status: 'confirmed',
  createdAt: FieldValue.serverTimestamp(),
};

// ã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡ãƒ‡ãƒ¼ã‚¿ã«ã‚‚ organizationId ã‚’è¿½åŠ 
const stepDeliveries = stepDelivery.createStepDeliverySchedule(
  applicationId,
  userId,
  slotAt,
  eventData.organizationId // è¿½åŠ 
);
```

#### `functions/src/utils/step-delivery.ts`
```typescript
export function createStepDeliverySchedule(
  applicationId: string,
  userId: string,
  seminarDate: Timestamp,
  organizationId: string // è¿½åŠ 
): Omit<StepDelivery, 'id'>[] {
  // ... existing code ...
  return STEP_MESSAGES.map((config) => ({
    organizationId, // è¿½åŠ 
    applicationId,
    userId,
    stepNumber: config.step,
    scheduledAt,
    sentAt: null,
    status: 'pending' as StepDeliveryStatus,
    message: config.message,
    createdAt: Timestamp.now(),
  }));
}
```

### 5. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Next.js ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰
npm run build

# Firebase ã«ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy
```

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

1. **Firebaseè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `lib/firebase.ts` ã«ã¯æ—¢ã«æœ¬ç•ªã®Firebaseè¨­å®šãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€APIã‚­ãƒ¼ã¯ç’°å¢ƒå¤‰æ•°ã«ç§»è¡Œã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

2. **Zod ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ç¾åœ¨ Zod v4 ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ãŒã€å¤šãã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ v3 ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š
   ```bash
   npm install zod@^3.23.0
   ```

3. **organizationId ã®è¿½åŠ **: æ—¢å­˜ã®Firestoreãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ `organizationId` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

4. **æ—¢å­˜ã®LIFFã‚¢ãƒ—ãƒª**: æ—¢å­˜ã®ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆLIFFï¼‰ã¯å¼•ãç¶šãå‹•ä½œã—ã¾ã™ãŒã€organizationId ã‚’è€ƒæ…®ã™ã‚‹ã‚ˆã†ã«æ›´æ–°ãŒå¿…è¦ã§ã™ã€‚

## ğŸ¯ ä»Šå¾Œã®æ‹¡å¼µææ¡ˆ

### ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆæ¨å¥¨ï¼‰
- [ ] ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†æ©Ÿèƒ½ï¼ˆæ‹›å¾…ã€æ¨©é™ç®¡ç†ï¼‰
- [ ] è©³ç´°ãªåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚¿
- [ ] Webhookã‚µãƒãƒ¼ãƒˆ
- [ ] API Keyç®¡ç†

### ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆå°†æ¥ï¼‰
- [ ] ãƒ—ãƒ©ãƒ³ç®¡ç†ãƒ»èª²é‡‘ã‚·ã‚¹ãƒ†ãƒ 
- [ ] ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ
- [ ] ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒ«æ©Ÿèƒ½
- [ ] é«˜åº¦ãªæ¨©é™ç®¡ç†ï¼ˆRBACï¼‰

## ğŸ“ ä½¿ã„æ–¹

### 1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
1. `/signup` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã™ã‚‹ã¨è‡ªå‹•çš„ã«çµ„ç¹”ãŒä½œæˆã•ã‚Œã¾ã™

### 2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã‚¢ã‚¯ã‚»ã‚¹
ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€`/dashboard` ã«è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™

### 3. ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ã€Œã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œæ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã¨é–‹å‚¬æ—¥æ™‚ã‚’å…¥åŠ›
4. ä¿å­˜

### 4. ç”³è¾¼ã®ç¢ºèª
1. ã€Œç”³è¾¼è€…ç®¡ç†ã€ç”»é¢ã§å…¨ã¦ã®ç”³è¾¼ã‚’ç¢ºèª
2. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§çµã‚Šè¾¼ã¿
3. CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯èƒ½

### 5. ã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡ã®ç¢ºèª
1. ã€Œã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡ã€ç”»é¢ã§é…ä¿¡çŠ¶æ³ã‚’ç¢ºèª
2. è‡ªå‹•é…ä¿¡ã¯æ—¢å­˜ã®Cloud FunctionãŒå®Ÿè¡Œ

## ğŸ‰ å®Œæˆï¼

ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã®SaaSå‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒå®Œæˆã—ã¾ã—ãŸï¼
æ¬¡ã¯å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆã—ã¦ã€å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ã€‚
